<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>
    <div id="formcontainer">
        <form>
            <div class="item">
                <label id="firstname" class="name">姓氏</label>
                <input id="firstnameInput" class="input">
            </div>
            <div class="item">
                <label id="lastname" class="name">名稱</label>
                <input id="lastnameInput" class="input">
            </div>
            <div class="buttons item">
                <button id="savebutton">儲存</button>
            </div>
        </form>
      
    </div>
    <div id="tablecontainer">
        <table id="nametable" border="1">
            <thead>
                <tr>
                    <th>id</th>
                    <th>姓氏</th>
                    <th>名稱</th>
                    <th>修改</th>
                    <th>刪除</th>
                </tr>
            </thead>
            <tbody id="tablebody">

            </tbody>
        </table>
        <div id="pagination-container">
            <!-- 分頁按鈕將被添加在這裡 -->
        </div>
    </div>
    <script>
       
//創建姓名資料
$(document).ready(function () {
    $("#savebutton").click(function (event) {
        event.preventDefault();
        // 取得輸入的資料
        var firstname = $("#firstnameInput").val();
        var lastname = $("#lastnameInput").val();

        // 檢查是否有輸入值
        if (firstname.trim() === '' || lastname.trim() === '') {
            alert("請輸入姓氏和名稱");
            return;
        }
        // 發送 POST 請求
        $.ajax({
            url: "http://localhost:8081/namerecords/create",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                firstname: firstname,
                lastname: lastname
            }),
            dataType: "json", // 指定預期的回應類型
            success: function (data) {
                            // 成功處理
                            console.log("資料儲存成功", data);
                            $("#firstnameInput").val('');
                            $("#lastnameInput").val('');
                             //在按下"儲存"按鈕後，自動更新表格資料
                            $("#nametable tbody").append(
                                "<tr>" +
                                "<td>" + data.id + "</td>" +
                                "<td>" + data.firstname + "</td>" +
                                "<td>" + data.lastname + "</td>" +
                                "<td><button class='edit-button' data-id='" + data.id + "'>修改</button></td>" +
                                "<td><button class='delete-button' data-id='" + data.id + "'>刪除</button></td>" +
                                "</tr>"
                            );
                        },
                        error: function (error) {
                            // 錯誤處理
                            console.error("資料儲存失敗", error);
                        }
            
        });

    });
    // // 在刪除按鈕的點擊事件處理程序中
    //     $(".delete-button").click(function () {
    //         var id = $(this).data("id");
    //         $.ajax({
    //             url: "http://localhost:8081/namerecords/delete/" + id,
    //             type: "DELETE",
    //             success: function (data) {
    //                 // 處理刪除成功的邏輯
    //                 console.log("資料刪除成功", data);
    //             },
    //             error: function (error) {
    //                 // 處理刪除失敗的邏輯
    //                 console.error("資料刪除失敗", error);
    //             }
    //         });
    //     });

        // 當前頁和頁面大小變量
        var currentPage = 0;
        var pageSize = 10;

        // 根據頁面和大小加載數據的函數
        function loadData() {
            $.ajax({
                url: "http://localhost:8081/namerecords/pages",
                type: "GET",
                dataType: "json",
                data: {
                    page: currentPage,
                    size: pageSize
                },
                success: function (data) {
                    console.log("获取数据成功", data);

                    // 清空表格數據
                    $("#nametable tbody").empty();

                    // 遍歷數據並將其添加到表格中
                    for (var i = 0; i < data.content.length; i++) {
                        $("#nametable tbody").append(
                            "<tr>" +
                            "<td>" + data.content[i].id + "</td>" +
                            "<td>" + data.content[i].firstname + "</td>" +
                            "<td>" + data.content[i].lastname + "</td>" +
                            "<td><button class='edit-button' data-id='" + data.id + "'>修改</button></td>" +
                            "<td><button class='delete-button' data-id='" + data.id + "'>刪除</button></td>" +
                            "</tr>"
                        );
                    }

                    // 渲染分頁按鈕
                    renderPagination(data);
                },
                error: function (error) {
                    console.error("获取数据失败", error);
                }
            });
        }

        // 渲染分頁按鈕的函數
        function renderPagination(data) {
            var totalPages = data.totalPages;

            // 清除先前的分頁按鈕
            $("#pagination-container").empty();

            // 創建並添加分頁按鈕
            for (var i = 0; i < totalPages; i++) {
                $("#pagination-container").append(
                    "<button class='pagination-button' data-page='" + i + "'>" + (i + 1) + "</button>"
                );
            }

            // 為分頁按鈕添加點擊事件
            $(".pagination-button").click(function () {
                currentPage = $(this).data("page");
                loadData();
            });
        }

        // 附加單擊事件以保存按鈕
        $("#savebutton").click(function (event) {
            event.preventDefault();
            // 保存數據的現有代碼...

            // 保存數據後，重新加載帶分頁的表格
            loadData();
        });

        // 在頁面加載時加載初始數據
        loadData();
    });

    </script>
</body>

</html>